{% extends 'base.html' %}
{% load humanize%}
{% block content %}


<div class='discussionDetails'>
<h1>Discussion on {{discussion.title}}</h1>  <h4>Created by:{{user.profile.first_name}}</h4>


<span class='discussionDetails'>Post: {{discussion.post}}</span>
<br>


{% comment %} <form action='{% url 'like' discussion.id %}' method="POST"> {% endcomment %}
{% comment %} {% csrf_token%}
{%if user.is_authenticated %}
{%if liked%} {% endcomment %}
{% comment %} <button type= 'submit' value='{{discussion.id}}' name=like>Unlike</button>
{%else%}
<button type= 'submit' value='{{discussion.id}}' name='discussion_id'>Like</button>
{%endif%}
{%else%}
<small><a href="{%url 'login' %}">Login</a> to Like</small>
{% endif %}
</form>
-{{total_likes}} Likes  {% endcomment %}

{% if discussion.posted_by == user %} 
<button><a href="{% url 'discussion_update' discussion.id %}">Edit</button></a>

<button><a href="{% url 'discussion_delete' discussion.id%}">Delete</button></a>
{% endif %} 
<hr>
</div>

<h2>Comments ...</h2>

{% comment %} Reply Section {% endcomment %}
{% comment %} Reply Form {% endcomment %}
 {% if reply %}
 <h1>{{reply.post}}</h1>
 <h5>Be the first to reply...<a href={% url 'add_reply' discussion.id %}>Reply</a></h5>
 {% else%}  

 {% for reply in discussion.replies %}

<h5>{{reply.post}}</h5>
<strong>{{reply.date_added}}</strong>

{% endfor%}
{%endif%}  

<form method='POST' action="{% url 'add_reply' discussion.id %}"> 

{%csrf_token %}
{{reply_form.as_p}}

<button type='submit'>Submit</button>
<button><a href="{% url 'discussion_detail' discussion.id %}" >Cancel</button></a> 
</form>
 {% for reply in discussion.replies.all %}
<p>{{reply}} 

 ({{reply.updated_at | naturaltime}})

{% if reply.posted_by == user%}
<button><a href='{% url 'discussion_reply_delete' reply%}'>Delete</a></button> 
 {% for reply in replies%} 


{%endfor%}
{%endif%}
 {% endfor%} 
{% endblock %}